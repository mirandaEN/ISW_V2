<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenido Auxiliar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stile_inadmin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #inactivityModal .modal-header { background-color: #ffc107; color: #333; }
    </style>
</head>
<body>
    
    <header>
        <div class="menu container">
            <a href="{{ url_for('interface_aux') }}" class="logo">Instituto Tecnológico de Saltillo</a>
            <input type="checkbox" id="menu">
            <label for="menu">
                <img src="{{ url_for('static', filename='sources/menu.png') }}" class="menu-icono" alt="">
            </label>
            <nav class="navbar">
                <ul>
                    <li><a href="{{ url_for('interface_aux') }}">Inicio</a></li>
                    <li><a href="{{ url_for('prestamos') }}">Prestamos</a></li>
                    <li><a href="{{ url_for('inventario') }}">Inventario</a></li>
                    <li><a href="{{ url_for('gestion_danos') }}">Daños</a></li>
                    <li><a href="{{ url_for('soporte') }}">Soporte</a></li>
                    
                    {% if login_time_iso %}
                    <li style="color: #6d0a0a; padding: 14px 20px; font-size: 0.9em; align-self: center;">
                        <i class="fas fa-clock"></i> Sesión: 
                        <span id="session-timer" style="font-weight: bold;">00:00:00</span>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        <div class="header-content container">
            <div class="content">
                <h1>Laboratorio de Electrónica / Analógica</h1>
                <p>Bienvenido Auxiliar ⚙️</p>
                <a href="{{ url_for('soporte') }}" class="btn-1">Contacto</a>
            </div>
            <img class="banner" src="{{ url_for('static', filename='sources/itislogo.png') }}" alt="">
            </div>
    </header>
    <main class="info container">
        <div class="box">
            <img src="{{ url_for('static', filename='sources/prestamos.png') }}" alt="">
            <h3>Prestamos</h3>
            <div class="description-content">
                <p>Este módulo permite registrar, modificar y controlar el flujo de entrada y salida de todo el material solicitado por los alumnos.</p>
            </div>
            <a href="{{ url_for('prestamos') }}" class="btn-1">IR</a>
        </div>
        <div class="box">
            <img src="{{ url_for('static', filename='sources/inventario.png') }}" alt="">
            <h3>Inventario</h3>
            <div class="description-content">
                <p>Accede al inventario central para consultar el stock total, disponible y dañado de los materiales.</p>
            </div>
            <a href="{{ url_for('inventario') }}" class="btn-1">IR</a>
        </div>
        <div class="box">
            <img class="daño" src="{{ url_for('static', filename='sources/chat_8532893.png') }}" alt="">
            <h3>Daños</h3>
            <div class="description-content">
                <p>Gestiona los registros de material dañado o extraviado. Permite marcar la reposición por parte del alumno.</p>
            </div>
            <a href="{{ url_for('gestion_danos') }}" class="btn-1">IR</a>
        </div>
    </main>
    <div class="logout-fixed">
        <a href="{{ url_for('logout') }}" class="btn-logout">Cerrar Sesión</a>
    </div>

    <div class="modal fade" id="inactivityModal" tabindex="-1" aria-labelledby="inactivityModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
             <div class="modal-content">
                 <div class="modal-header">
                     <h5 class="modal-title" id="inactivityModalLabel">Advertencia de Inactividad</h5>
                 </div>
                 <div class="modal-body">
                     <p>Tu sesión está a punto de expirar.</p>
                     <p>Tiempo restante: <strong id="inactiveTimeLeft">60</strong> segundos.</p>
                 </div>
                 <div class="modal-footer">
                     <button type="button" class="btn btn-secondary" onclick="forceLogout()">Cerrar Sesión</button>
                     <button type="button" class="btn btn-primary" onclick="resetInactivityTimer()">Continuar</button>
                 </div>
             </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- SCRIPT TIMER SESIÓN ACTIVA ---
        const timerElement = document.getElementById('session-timer');
        const loginTimeISO = '{{ login_time_iso | safe }}'; 
        if (timerElement && loginTimeISO && loginTimeISO !== 'None') {
            const loginTime = new Date(loginTimeISO);
            function updateSessionTimer() {
                const now = new Date();
                const elapsedSeconds = Math.floor((now - loginTime) / 1000);
                const hours = Math.floor(elapsedSeconds / 3600);
                const minutes = Math.floor((elapsedSeconds % 3600) / 60);
                const seconds = elapsedSeconds % 60;
                timerElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
            setInterval(updateSessionTimer, 1000);
            updateSessionTimer();
        }
        // --- FIN SCRIPT TIMER SESIÓN ---
    </script>
    <script>
        // --- SCRIPT INACTIVIDAD ---
        const inactivityLimitSeconds = {{ inactivity_limit | default(300) }};
        const warningTimeSeconds = 60;
        // ... (Pega el script de inactividad completo aquí, igual que en admin) ...
        let inactivityTimer, warningTimer, countdownValue, inactivityModal, isWarningModalShown = false; function initializeModalInstance(){if(!inactivityModal){const e=document.getElementById("inactivityModal");e?inactivityModal=new bootstrap.Modal(e,{backdrop:"static",keyboard:!1}):console.error("Modal element #inactivityModal not found!")}}function handleUserActivity(){clearTimeout(inactivityTimer),isWarningModalShown&&hideInactivityWarning(),inactivityTimer=setTimeout(showInactivityWarning,(inactivityLimitSeconds-warningTimeSeconds)*1e3)}function showInactivityWarning(){isWarningModalShown=!0,countdownValue=warningTimeSeconds;const e=document.getElementById("inactiveTimeLeft");if(!e)return;e.textContent=countdownValue,initializeModalInstance();if(!inactivityModal)return;try{inactivityModal.show()}catch(e){return void console.error("Error showing modal:",e)}clearInterval(warningTimer),warningTimer=setInterval(()=>{countdownValue--,e&&(e.textContent=countdownValue),countdownValue<=0&&forceLogout()},1e3)}function hideInactivityWarning(){if(isWarningModalShown&&inactivityModal)try{const e=document.getElementById("inactivityModal"),t=bootstrap.Modal.getInstance(e);e&&t&&e.classList.contains("show")&&t.hide()}catch(e){console.error("Error hiding modal:",e)}isWarningModalShown=!1,clearInterval(warningTimer)}async function resetInactivityTimer(){hideInactivityWarning();try{const e=await fetch("{{ url_for('keepalive') }}");if(!e.ok)return console.warn("Server session seems expired. Redirecting to login."),void forceLogout();handleUserActivity()}catch(e){console.error("Error calling keepalive:",e),handleUserActivity()}}function forceLogout(){clearTimeout(inactivityTimer),clearInterval(warningTimer),window.location.href="{{ url_for('logout') }}?reason=inactivity"}document.addEventListener("click",handleUserActivity,!0),document.addEventListener("mousemove",handleUserActivity,!0),document.addEventListener("keypress",handleUserActivity,!0),document.addEventListener("scroll",handleUserActivity,!0),document.addEventListener("DOMContentLoaded",()=>{initializeModalInstance(),handleUserActivity()});
        // --- FIN SCRIPT INACTIVIDAD ---
    </script>
</body>
</html>